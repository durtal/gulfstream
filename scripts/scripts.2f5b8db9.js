"use strict";angular.module("gulfstreamApp",["ui.router","ngResource","angularUtils.directives.dirPagination","perfect_scrollbar","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/home"),a.state("home",{url:"/home",templateUrl:"views/main.html",controller:"RatingsCtrl"}).state("about",{url:"/about",templateUrl:"views/about.html"}).state("blog",{url:"/blog",templateUrl:"views/blog-home.html"}).state("blog.31-1-15",{url:"/31-1-15",templateUrl:"views/blog/3-2-15.html"}).state("blog.7-2-15",{url:"/2015-DonnHcp-&-TurfHcp",templateUrl:"views/blog/7-2-15.html"}).state("blog.gulfstream-data",{url:"/gulfstream-data",templateUrl:"views/blog/gulfstream-data.html"}).state("blog.zipf_hcp-visualisation",{url:"/zipf_hcp-visualisation",templateUrl:"views/blog/zipf_hcp-visualisation.html",controller:"ZipfHcpvisCtrl"}).state("blog.21-2-15",{url:"/2015-FountainOfYouth",templateUrl:"views/blog/21-2-15.html"}).state("ratings",{url:"/ratings",templateUrl:"views/ratings.html",controller:"RatingsCtrl"}).state("ratings.all",{url:"/all",templateUrl:"views/all_ratings.html",controller:"RatingsCtrl"}).state("ratings.horse",{url:"/horse/{horse_id}",templateUrl:"views/horse.html",controller:"HorseCtrl",resolve:{horse:["$http","$stateParams","_",function(a,b,c){return a.get("data/gulfstream-ratings.json").then(function(a){var d=c.findWhere(a.data,{_id:b.horse_id});return d})}]}}).state("ratings.handicappingmethod",{url:"/handicapping-method",templateUrl:"views/handicapping/handicapping_method.html"}).state("track_profiles",{url:"/track-profiles",templateUrl:"views/track_profiles.html"}).state("track_profiles.5f",{url:"/5-furlong-profile",templateUrl:"views/track_profiles/5f.html"}).state("track_profiles.5-5f",{url:"/5.5-furlong-profile",templateUrl:"views/track_profiles/5-5f.html"}).state("track_profiles.6f",{url:"/6-furlong-profile",templateUrl:"views/track_profiles/6f.html"}).state("track_profiles.6-5f",{url:"/6.5-furlong-profile",templateUrl:"views/track_profiles/6-5f.html"}).state("track_profiles.7f",{url:"/7-furlong-profile",templateUrl:"views/track_profiles/7f.html"}).state("track_profiles.7-5f",{url:"/7.5-furlong-profile",templateUrl:"views/track_profiles/7-5f.html"}).state("track_profiles.8f",{url:"/8-furlong-profile",templateUrl:"views/track_profiles/8f.html"}).state("track_profiles.8-5f",{url:"/8.5-furlong-profile",templateUrl:"views/track_profiles/8-5f.html"}).state("track_profiles.9f",{url:"/9-furlong-profile",templateUrl:"views/track_profiles/9f.html"}).state("track_profiles.11-12f",{url:"/11-to-12-furlong-profile",templateUrl:"views/track_profiles/11-12f.html"})}]),angular.module("gulfstreamApp").controller("RatingsCtrl",["$scope","RcappeRHorses",function(a,b){a.currentPage=1,a.pageSize=10,b.getRatings(function(b){a.horses=b}),a.predicate="-n_races"}]),angular.module("gulfstreamApp").factory("RcappeRHorses",["$http",function(a){var b={};return b.getRatings=function(b){a.get("data/gulfstream-ratings.json").success(b)},b}]),angular.module("gulfstreamApp").controller("HorseCtrl",["$scope","horse","_",function(a,b,c){a.horse=b,a.races=c.toArray(a.horse.races)}]),angular.module("gulfstreamApp").factory("_",function(){return window._}),angular.module("gulfstreamApp").directive("singleRaceDir",function(){return{templateUrl:"views/directiveViews/singleRaceDir.tpl.html",restrict:"E",scope:{race:"="},link:function(){}}}),angular.module("gulfstreamApp").controller("ZipfHcpvisCtrl",["$scope","_","$http",function(a,b,c){function d(a,b){var c={p1:b.p1+parseInt(a.p1),p2:b.p2+parseInt(a.p2),p3:b.p3+parseInt(a.p3),p4:b.p4+parseInt(a.p4),p5:b.p5+parseInt(a.p5)};c={p1:1*c.p1/1,p2:1*c.p2/2,p3:1*c.p3/3,p4:1*c.p4/4,p5:1*c.p5/5};var d=c.p1+c.p2+c.p3+c.p4+c.p5,e=1.5+1/3+.25+.2,f=d/e;return f}a.ExampleRaces=[{year:2009,p1:100,p2:98,p3:95,p4:90,p5:76},{year:2010,p1:95,p2:94,p3:93,p4:88,p5:87},{year:2011,p1:102,p2:90,p3:80,p4:75,p5:73}],a.weightedRatings=[{year:2009,p1:100,p2:103,p3:105,p4:105,p5:96},{year:2010,p1:95,p2:99,p3:103,p4:103,p5:107},{year:2011,p1:102,p2:95,p3:90,p4:90,p5:93}],a.unratedRace={year:2012,p1:0,p2:5,p3:10,p4:15,p5:20},a.unratedRace2={year:2012,p1:0,p2:5,p3:10,p4:15,p5:20},a.singleRace={p1:100,p2:95,p3:90,p4:85,p5:80},a.unratedRaceRating=d(a.unratedRace2,a.ExampleRaces[0]),a.$watch("unratedRace2",function(b){a.unratedRaceRating=d(b,a.ExampleRaces[0])},!0),c.get("data/dummy-ratings.json").success(function(c){a.dummyRatings=c,a.dummyWinningRatings=b.map(a.dummyRatings,function(a){return a.p1}),a.zipfHcpRatings=[],b.each(a.dummyRatings,function(b,c){var e=d(a.unratedRace2,b);a.zipfHcpRatings[c]=e}),a.avgRtg=d3.mean(a.zipfHcpRatings),a.unratedRace3={p1:0,p2:5,p3:10,p4:15,p5:20},a.$watch("unratedRace3",function(c){var e=c;b.each(a.dummyRatings,function(b,c){var f=d(e,b);a.zipfHcpRatings[c]=f}),a.avgRtg=d3.mean(a.zipfHcpRatings)},!0)})}]),angular.module("gulfstreamApp").directive("rcapperD3Histogram",function(){function a(a,b,c){var d={top:10,right:10,bottom:40,left:10},e=550-d.left-d.right,f=340-d.top-d.bottom,g=d3.select(b[0]).append("svg").attr("width",e+d.left+d.right).attr("height",f+d.top+d.bottom);a.$watch("data",function(a){g.selectAll("*").remove();var b=Math.floor(d3.min(a)),h=Math.ceil(d3.max(a)),i=h-b,j=d3.scale.linear().domain([0,i]).range([0,e]),k=d3.scale.linear().domain([b,h]).range([0,e]),l=d3.layout.histogram().bins(i)(a);console.log(l);var m=d3.scale.linear().domain([0,d3.max(l,function(a){return a.y})]).range([f,0]),n=d3.svg.axis().scale(k).orient("bottom");g.append("g").attr("transform","translate("+d.left+","+d.top+")");var o=g.selectAll(".bar").data(l).enter().append("g").attr("class","bar").attr("transform",function(a){return"translate("+k(a.x)+","+m(a.y)+")"}).style("fill",c.fill);o.append("rect").attr("x",1).attr("width",j(l[0].dx)).attr("height",f-d.botttom).transition().delay(function(a,b){return 100*b}).duration(200).attr("height",function(a){return f-m(a.y)}),g.append("g").attr("class","x-axis").attr("transform","translate(0,"+f+")").call(n)},!0)}return{restrict:"E",scope:{data:"="},link:a}});